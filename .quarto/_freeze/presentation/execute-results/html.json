{
  "hash": "ec88d3b173615e958ffc4448a04cdbd7",
  "result": {
    "markdown": "---\ntitle: \"Cadre R chez IMPACT Initiatives\"\nauthor: \"Yann Say\"\ndate: 12/06/2024\ndate-format: \"DD/MM/YYYY\"\nexecute:\n  echo: true\n  message: false\n  output: false\n  cache: true\n\nformat: \n  revealjs:\n    logo: scss/IMPACT_Family_Logo_TransparentBackground.png\n    theme: scss/impact_theme.scss\n\ntitle-slide-attributes:\n    data-background-image: scss/01titlenologo.png\n    \nembed-resources: true\n---\n\n\n# Contents {background-image=\"scss/02contents.png\"}\n\n::: columns\n::: {.column width=\"60%\"}\n:::\n\n::: {.column width=\"40%\"}\n1.  Raisons\n2.  Cadre R\n3.  En pratique\n:::\n:::\n\n# Raisons {.section background-image=\"scss/03section.png\"}\n\n## Raisons {.page background-image=\"scss/04page.png\"}\n\n-   **~ 30 pays**: Beaucoup d'équipes et de projets\n-   **80%** des scripts de nettoyage et **50%** des analyses utilisent des fonctions personnelles\n\n# Cadre R chez IMPACT {.section background-image=\"scss/03section.png\"}\n\n## Cadre R {.page background-image=\"scss/04page.png\"}\n\nCadre d'analyse modulaire à 2 dimensions:\n\n-   une dimension **verticale** qui se concentre sur le **contenu** d’une étape\n-   une dimension **horizontale** qui se concentre sur le **résultat** d’une étape\n\n##  {.page background-image=\"scss/04page.png\"}\n\n![Cadre R chez IMPACT](images/presentation/cadre-complet.png){.center}\n\n- 4 étapes\n- 4 verbes\n- 2 adjectifs\n\n\n## 4 étapes {.page background-image=\"scss/04page.png\"}\n\n![](images/presentation/4-étapes.png){width=\"200\"}\n\n##  {.page background-image=\"scss/04page.png\"}\n\n-   **Nettoyage** : Toute manipulation pour passer des données brutes aux données propres\n\n::: incremental\n-   **Composition** : Toute manipulation avant l'analyse, par ex. ajout d'indicateurs, combiner deux bases de données (avant et après une distribution). Les indicateurs sont créés avant l'analyse, et non avec l'analyse.\n-   **Analyse** : Toute manipulation concernant uniquement l'analyse. L'analyse s'arrête à la table des résultats. La table de résultat est format long : statistique + clé d'analyse.\n-   **Présentation** : Toute manipulation pour formater la table des résultats.\\\n:::\n\n## 4 verbes {.page background-image=\"scss/04page.png\"}\n\n![](images/presentation/4-verbes.png){width=\"200\"}\n\n##  {.page background-image=\"scss/04page.png\"}\n\n-   **Ajouter (add\\_\\*)**: Une fonction qui ajoute une variable (colonne) au jeu de données. Par exemple, pour ajouter la durée d’une enquête, pour ajouter la catégorie de score de consommation alimentaire, etc.\n\n::: fragment\n-   **Vérifier (check\\_\\*)**: Une fonction qui va signaler certaines valeurs (par exemple, valeurs autres à recoder, valeurs aberrantes, etc.). Un check\\_\\* renverra une liste : le jeu de données vérifié et le journal de nettoyage.\n:::\n\n##  {.page background-image=\"scss/04page.png\"}\n\n-   **Créer (create\\_\\*)**: Une fonction qui créé, transforme quelque chose, par exemple créer un journal de nettoyage avec des actions à faire, créer une table de résultats d’analyse, créer un produit pour une présentation.\n\n::: fragment\n-   **Revoir (review\\_\\*)**: Une fonction qui examinera un objet en le comparant à des standards ou à un autre objet et signalera les différences, par exemple en examinant le nettoyage en comparant le jeu de données brut, le jeu de données propre et le journal de nettoyage, l’analyse le comparant à une autre analyse.\n:::\n\n## 2 adjectifs {.page background-image=\"scss/04page.png\"}\n\n![](images/presentation/cadre-complet.png)\n\n##  {.page background-image=\"scss/04page.png\"}\n\n-   **« pipeable »** : Chaque étape, chaque famille de fonctions (verbes) peuvent être utilisée une après l’autre. Cela permet à l’utilisateur.ice de pouvoir adapter chaque étape avec les fonctions spécifiques à son contexte.\n\n::: fragment\n-   **Indépendant** : A chaque étape, le cadre définit l’entrée et la sortie, le \"comment\" est libre, chaque utilisateur.ice peut donc choisir l’outil qu’il/elle préfère.\\\n:::\n\n## 4 packages {.page background-image=\"scss/04page.png\"}\n\n-   `cleaningtools`\n-   `addindicators`\n-   `analysistools`\n-   `presentresults`\n\n<br/> https://github.com/impact-initiatives/\n\n# Nettoyage {.section background-image=\"scss/03section.png\"}\n\n##  {.page background-image=\"scss/04page.png\"}\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-1_357038fc56ca825dabcf6612b5ce40e4'}\n\n:::\n\n\n### check\\_\n\n::: fragment\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-2_540f0361120da0e21629dc8b9d6b3c71'}\n\n```{.r .cell-code}\nmy_log1 <- my_raw_dataset %>% \n  check_outliers(uuid_column = \"X_uuid\")\n```\n:::\n\n:::\n\n<br/>\n\n::: fragment\n\n::: {.cell output-location='column-fragment' hash='presentation_cache/revealjs/unnamed-chunk-3_76b5af82ba8df0ec77caddc0cd7c9664'}\n\n```{.r .cell-code}\ntypeof(my_log1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"list\"\n```\n:::\n:::\n\n:::\n\n<br/>\n\n::: fragment\n\n::: {.cell output-location='column-fragment' hash='presentation_cache/revealjs/unnamed-chunk-4_6bba3c03f2316b3f1e4f73347e1c8572'}\n\n```{.r .cell-code}\nmy_log1 %>% \n  names()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"checked_dataset\"    \"potential_outliers\"\n```\n:::\n:::\n\n:::\n\n##  {.page background-image=\"scss/04page.png\"}\n\n\n::: {.cell output-location='fragment' hash='presentation_cache/revealjs/unnamed-chunk-5_0af9a702c23a7c3271d7402290555c21'}\n\n```{.r .cell-code}\nmy_log1$potential_outliers %>% \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  uuid                                 issue                  question old_value\n  <chr>                                <chr>                  <chr>        <dbl>\n1 b5b1d37a-e27a-4c35-a0f5-2cde9d6dfd06 outlier (normal distr… age_res…        86\n2 956b5ed0-5a62-41b7-aec3-af93fbc5b494 outlier (normal distr… age_res…        84\n3 97ad6294-30c6-454e-a0b3-42126415b767 outlier (log distribu… age_res…        18\n4 e005e719-57c4-44a3-ac2f-5d6d1ff68831 outlier (log distribu… age_res…        18\n5 c9aaa542-118f-4e42-93de-fb0916572541 outlier (normal distr… num_hh_…        19\n6 48e8896b-d1be-4600-8839-2d8b994ebcfb outlier (normal distr… num_hh_…        19\n```\n:::\n:::\n\n\n##  {.page background-image=\"scss/04page.png\"}\n\n### pipe-able\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-6_c08b6541c9d15cf05a6402fd6ca50e6c'}\n\n```{.r .cell-code}\nmore_logs <- my_raw_dataset %>% \n  check_duplicate(uuid_column = \"X_uuid\") %>% \n  check_soft_duplicates(uuid_column = \"X_uuid\", kobo_survey = my_kobo_survey, sm_separator = \".\") %>%\n  check_outliers(uuid_column = \"X_uuid\") %>%\n  check_value(uuid_column = \"X_uuid\") \n```\n:::\n\n\n<br/>\n\n::: fragment\n\n::: {.cell output-location='column-fragment' hash='presentation_cache/revealjs/unnamed-chunk-7_7ecef527662f414a438d98fc91302e7b'}\n\n```{.r .cell-code}\nnames(more_logs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"checked_dataset\"    \"duplicate_log\"      \"soft_duplicate_log\"\n[4] \"potential_outliers\" \"flaged_value\"      \n```\n:::\n:::\n\n:::\n\n##  {.page background-image=\"scss/04page.png\"}\n\n\n::: {.cell output-location='fragment' hash='presentation_cache/revealjs/unnamed-chunk-8_f16dbac3fe83c35a1f5a1f4adf4eff9a'}\n\n```{.r .cell-code}\nmore_logs$potential_outliers %>% \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  uuid                                 issue                  question old_value\n  <chr>                                <chr>                  <chr>        <dbl>\n1 b5b1d37a-e27a-4c35-a0f5-2cde9d6dfd06 outlier (normal distr… age_res…        86\n2 956b5ed0-5a62-41b7-aec3-af93fbc5b494 outlier (normal distr… age_res…        84\n3 97ad6294-30c6-454e-a0b3-42126415b767 outlier (log distribu… age_res…        18\n4 e005e719-57c4-44a3-ac2f-5d6d1ff68831 outlier (log distribu… age_res…        18\n5 c9aaa542-118f-4e42-93de-fb0916572541 outlier (normal distr… num_hh_…        19\n6 48e8896b-d1be-4600-8839-2d8b994ebcfb outlier (normal distr… num_hh_…        19\n```\n:::\n:::\n\n\n::: fragment\n\n::: {.cell output-location='fragment' hash='presentation_cache/revealjs/unnamed-chunk-9_2a2ba16288a45095aa69b0b6f6876c63'}\n\n```{.r .cell-code}\nmore_logs$duplicate_log %>% \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 0 × 4\n# ℹ 4 variables: uuid <chr>, old_value <chr>, question <chr>, issue <glue>\n```\n:::\n:::\n\n:::\n\n##  {.page background-image=\"scss/04page.png\"}\n\n### create\n\n\n::: {.cell output-location='fragment' hash='presentation_cache/revealjs/unnamed-chunk-10_b6f517d97d3c520a3330ddbe359c780c'}\n\n```{.r .cell-code}\nmy_combined_log <- create_combined_log(more_logs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nList of element to combine- checked_dataset, duplicate_log, soft_duplicate_log, potential_outliers, flaged_value\n```\n:::\n:::\n\n\n<br/>\n\n::: fragment\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-11_bf18cc7d61bb8b88ad0305b96ef05665'}\n\n```{.r .cell-code}\nnames(my_combined_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"checked_dataset\" \"cleaning_log\"   \n```\n:::\n:::\n\n:::\n\n##  {.page background-image=\"scss/04page.png\"}\n\n\n::: {.cell output-location='fragment' hash='presentation_cache/revealjs/unnamed-chunk-12_2ec566551038b16a42d3462c5557a816'}\n\n```{.r .cell-code}\nmy_combined_log$cleaning_log %>% \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  uuid              old_value question issue change_type new_value check_binding\n  <chr>             <chr>     <chr>    <chr> <chr>       <chr>     <chr>        \n1 b5b1d37a-e27a-4c… 86        age_res… outl… <NA>        <NA>      age_responde…\n2 956b5ed0-5a62-41… 84        age_res… outl… <NA>        <NA>      age_responde…\n3 97ad6294-30c6-45… 18        age_res… outl… <NA>        <NA>      age_responde…\n4 e005e719-57c4-44… 18        age_res… outl… <NA>        <NA>      age_responde…\n5 c9aaa542-118f-4e… 19        num_hh_… outl… <NA>        <NA>      num_hh_membe…\n6 48e8896b-d1be-46… 19        num_hh_… outl… <NA>        <NA>      num_hh_membe…\n```\n:::\n:::\n\n\n<br/>\n\n::: fragment\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-13_be47ccfe415992b75197e3c147960b15'}\n\n```{.r .cell-code}\ncreate_xlsx_cleaning_log(my_combined_log,\n                         kobo_survey = my_kobo_survey,\n                         kobo_choices = my_kobo_choice,\n                         use_dropdown = T,\n                         sm_dropdown_type = \"logical\",\n                         output_path =  \"outputs/02 - example - cleaning-log-with-kobo.xlsx\")\n```\n:::\n\n:::\n\n::: fragment\n::: {layout-ncol=\"2\"}\n![](images/presentation/cleaninglog-change-type.png)\n\n![](images/presentation/cleaninglog-new-valuepng.png)\n:::\n:::\n\n##  {.page background-image=\"scss/04page.png\"}\n\n### create\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-14_250fb6ad14980581468c9d49ca7dc2ee'}\n\n```{.r .cell-code}\nmy_filled_log <- readxl::read_excel(\"my_filled_log.xlsx\", sheet = 2)\n\nmy_clean_data <- create_clean_data(raw_dataset = my_raw_dataset,\n                                   raw_data_uuid_column = \"X_uuid\",\n                                   cleaning_log = my_filled_log, \n                                   cleaning_log_uuid_column = \"uuid\",\n                                   cleaning_log_question_column = \"question\",\n                                   cleaning_log_new_value_column = \"new_value\",\n                                   cleaning_log_change_type_column = \"change_type\")\n```\n:::\n\n\n##  {.page background-image=\"scss/04page.png\"}\n\n### review\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-15_f91bb352422890afe3571356cd1f1882'}\n\n:::\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-16_436860242a25887950cf68baae1c1fcd'}\n\n```{.r .cell-code}\nreview_of_cleaning <- review_cleaning(raw_dataset = my_raw_dataset,\n                    raw_dataset_uuid_column = \"X_uuid\", \n                    clean_dataset = my_clean_data2$data_with_fix_concat,\n                    clean_dataset_uuid_column = \"X_uuid\",\n                    cleaning_log = my_filled_log_no_deletion, \n                    cleaning_log_uuid_column = \"uuid\",\n                    cleaning_log_question_column = \"question\",\n                    cleaning_log_new_value_column = \"new_value\",\n                    cleaning_log_change_type_column = \"change_type\", \n                    cleaning_log_old_value_column = \"old_value\", \n                    deletion_log = my_deletion_log, \n                    deletion_log_uuid_column = \"uuid\"\n                    )\n```\n:::\n\n\n# Composition {.section background-image=\"scss/03section.png\"}\n\n##  {.page background-image=\"scss/04page.png\"}\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-17_9245d8e3b1fd8dcd799c71d475845846'}\n\n:::\n\n\n### add\n\n\n::: {.cell output-location='fragment' hash='presentation_cache/revealjs/unnamed-chunk-18_667d8e96b18553111f2e3b437ffe208d'}\n\n```{.r .cell-code}\nmy_data_with_indicators <- my_data %>%\n  add_fcs(\n  cutoffs = \"normal\",\n  fsl_fcs_cereal = \"fs_fcs_cereals_grains_roots_tubers\",\n  fsl_fcs_legumes = \"fs_fcs_beans_nuts\",\n  fsl_fcs_veg = \"fs_fcs_vegetables_leaves\",\n  fsl_fcs_fruit = \"fs_fcs_fruit\",\n  fsl_fcs_meat = \"fs_fcs_meat_fish_eggs\",\n  fsl_fcs_dairy = \"fs_fcs_dairy\",\n  fsl_fcs_sugar = \"fs_fcs_sugar\",\n  fsl_fcs_oil = \"fs_fcs_oil_fat_butter\"\n  ) %>%\n  add_hhs(\n  )\n\nmy_data_with_indicators[, tail(names(my_data_with_indicators), 14)] %>%\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  fsl_fcs_score fsl_fcs_cat fs_hhs_nofood_yn_recoded fs_hhs_nofood_freq_recoded\n1          48.5  Acceptable                        0                          0\n2          50.5  Acceptable                        1                          1\n3          46.5  Acceptable                        0                          0\n4          42.5  Acceptable                        0                          0\n5          55.5  Acceptable                        0                          0\n6          37.5  Acceptable                        1                          1\n  fs_hhs_sleephungry_yn_recoded fs_hhs_sleephungry_freq_recoded\n1                             0                               0\n2                             0                               0\n3                             1                               2\n4                             0                               1\n5                             0                               1\n6                             0                               2\n  fs_hhs_daynoteating_yn_recoded fs_hhs_daynoteating_freq_recoded hhs_comp1\n1                              0                                0         0\n2                              0                                1         1\n3                              1                                0         0\n4                              1                                0         0\n5                              1                                0         0\n6                              1                                2         1\n  hhs_comp2 hhs_comp3 hhs_score hhs_cat_ipc      hhs_cat\n1         0         0         0        None No or Little\n2         0         0         1      Little No or Little\n3         2         0         2    Moderate     Moderate\n4         0         0         0        None No or Little\n5         0         0         0        None No or Little\n6         0         2         3    Moderate     Moderate\n```\n:::\n:::\n\n\n# Analyse {.section background-image=\"scss/03section.png\"}\n\n##  {.page background-image=\"scss/04page.png\"}\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-19_538b4d2f4885a980656b36fa44e0c475'}\n\n:::\n\n\n### create\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-20_a932ec1a4f0fe4e5777a2141200741bd'}\n\n```{.r .cell-code}\nmy_design <- srvyr::as_survey_design(my_data_with_indicators, strata = \"admin1\")\n\nmy_analysis <- create_analysis(my_design, sm_separator = \"/\")\n```\n:::\n\n\n::: fragment\nEntrée pour `create_analysis` est un object `survey_design` de `survey`/`srvyr`\n:::\n\n::: fragment\n\n::: {.cell output-location='fragment' hash='presentation_cache/revealjs/unnamed-chunk-21_d8253006436b3d0547841de7ba0b84fd'}\n\n```{.r .cell-code}\nmy_analysis$results_table %>%\n  select(stat, analysis_key) %>%\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n   stat analysis_key                                                            \n  <dbl> <chr>                                                                   \n1 0.258 prop_select_one @/@ fcs_cat %/% low @/@ location %/% locationA -/- popu…\n2 0.323 prop_select_one @/@ fcs_cat %/% medium @/@ location %/% locationA -/- p…\n3 0.419 prop_select_one @/@ fcs_cat %/% high @/@ location %/% locationA -/- pop…\n4 0.25  prop_select_one @/@ fcs_cat %/% low @/@ location %/% locationA -/- popu…\n5 0.375 prop_select_one @/@ fcs_cat %/% medium @/@ location %/% locationA -/- p…\n6 0.375 prop_select_one @/@ fcs_cat %/% high @/@ location %/% locationA -/- pop…\n```\n:::\n:::\n\n:::\n\n# Produits {.page background-image=\"scss/04page.png\"}\n\n##  {.page background-image=\"scss/04page.png\"}\n\n### create\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-22_ab5c0d7943d3e5954f24b881d222518d'}\n\n```{.r .cell-code}\nlibrary(presentresults)\nmy_analysis$results_table %>% \n  create_table_group_x_variable() %>% \n  create_xlsx_group_x_variable(file_path = \"outputs/04 - example - group_x_variable.xlsx\", overwrite = T)\n```\n:::\n\n\n![](images/presentation/table%20group%20x%20variables.png)\n\n##  {.page background-image=\"scss/04page.png\"}\n\n\n::: {.cell hash='presentation_cache/revealjs/unnamed-chunk-23_b4e0443243f3ea3c2a77d15267076715'}\n\n```{.r .cell-code}\nmy_results_table %>% \n  create_table_variable_x_group() %>%\n  create_xlsx_variable_x_group(file_path = \"outputs/05 - example - variable_x_group.xlsx\", overwrite = T)\n```\n:::\n\n\n![](images/presentation/table%20variables%20x%20group.png)\n\n## Merci {.center .end background-image=\"scss/02contents.png\"}\n\n<br/> \nyann.say@impact-initiatives.org \n<br/> \n<br/> \nwww.impact-initiatives.org\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    // dispatch for htmlwidgets\r\n    function fireSlideEnter() {\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n    }\r\n\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n      fireSlideEnter();\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}